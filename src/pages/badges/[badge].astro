---
import Layout from '../../layouts/Layout.astro';
import { Code } from 'astro:components';
import type { BundledLanguage } from 'shiki'; 
import { badgesData } from '../../data/badgesData';
import { badgesBlocks as ComponentsPreviews } from "@/components/ui/badge/blocks/badgesBlocks"
import CopyIcon from '@/assets/icons/copyIcon.astro';
import CheckIcon from '@/assets/icons/checkIcon.astro';
import Sidebar from '@/components/home/Sidebar.astro';

const selectedComponent = ComponentsPreviews.find((comp) => comp.id === Astro.params.badge);
const selectedCode = badgesData.find((code) => code.id === Astro.params.badge);

if (!selectedComponent || !selectedCode) {
	throw new Error(`Component or code with id "${Astro.params.badge}" not found`);
}

export function getStaticPaths() {
  return badgesData.map((comp) => ({
    params: { badge: comp.id },
  }));
}

---
<Layout title={`UIComponents | @orbitui - ${selectedComponent.title}`}>
	<section class="w-full px-4 py-12 sm:px-6 lg:px-8">
        <Sidebar currentPage='badges'/>
		<article class="flex flex-col gap-20 justify-center items-center">
            <header class="flex flex-col gap-10 justify-center items-center w-full max-w-2xl">
                <div class="flex justify-center gap-5 w-full bg-slate-600/30 border border-gray-500 rounded-2xl px-8 py-6">
                    <selectedComponent.component />
                </div>
            </header>

			<footer class="flex flex-col gap-y-10 justify-center items-center w-full">
				<div class="group relative w-full max-w-4xl px-2 py-10 sm:px-4 overflow-x-auto">
					<Code code={`${selectedCode.code}`} lang={selectedCode.lang as BundledLanguage} wrap />
					<p class="component-name">{selectedCode.id.charAt(0).toUpperCase() + selectedCode.id.slice(1)}.{selectedCode.lang}</p>
					<div class="absolute top-13 right-7 flex justify-end items-center gap-5">
					<button role="button" aria-label="Copiar IP" class="copy-button text-white px-1 py-1 rounded-sm hover:bg-slate-600/80 transition-colors duration-300 cursor-pointer">
						<CopyIcon class="copy-icon size-3"/>
						<CheckIcon class="copy-icon-check hidden size-3"/>
					</button>
					</div>
				</div>
			</footer>
		</article>
	</section>
</Layout>
<script is:inline>

	const codeBlock = document.querySelector(".astro-code")
	const componentName = document.querySelector(".component-name")
	codeBlock.className = "rounded-xs p-3 border border-gray-500/50 group-hover:border-gray-500/80 transition-all duration-300"
	componentName.className = "absolute top-4.5 left-3 bg-[#24292e] w-fit ml-5 mb-1.5 border-r border-l border-t border-gray-500/50 group-hover:border-gray-500/80 text-gray-800 dark:text-gray-300 text-xs px-5 py-1 rounded-sm font-mono"

	const code = document.querySelector("code");
    const copyBtn = document.querySelector('.copy-button');
    const copyIcon = document.querySelector('.copy-icon');
    const copyIconCheck = document.querySelector('.copy-icon-check');
    
    copyBtn.addEventListener('click', () => {
        navigator.clipboard.writeText(code.textContent)
            .then(() => {
                copyIcon.classList.toggle("hidden")
                copyIconCheck.classList.toggle("hidden")
                setTimeout(() => {
                    copyIcon.classList.toggle("hidden")
                    copyIconCheck.classList.toggle("hidden")
                }, 2000);
            })
            .catch(err => {
                console.error("An error occurred while copying the text: ", err);
            });
    });

</script>
